{% load tailwind_filters %}
{% load partials %}

{% partialdef chat-bubble %}
<div class="flex items-start justify-end space-x-2">
    {% if request.user != message.from_user %}
    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm">You</div>
    {% endif %}

    <div class="bg-blue-500 text-white p-2 rounded-lg max-w-xs text-sm">
        {{ message.message }}
    </div>

    {% if request.user == message.from_user %}
    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm">Me</div>
    {% endif %}
</div>
{% endpartialdef %}

<div class="border flex-1 p-5 ">

    <h2 class="text-center">Chat</h2>
    <div>3 users online</div>

    <!-- <div class="flex items-start space-x-2">
        <div class="w-8 h-8 bg-purple-400 rounded-full flex items-center justify-center text-white text-sm">Aaa</div>
        <div class="bg-gray-200 p-2 rounded-lg max-w-xs">
            <p class="text-sm">Hey everyone!</p>
        </div>
    </div>

    -->

    <div id="chat_messages" class="h-56 overflow-y-auto space-y-4 p-4">
        {% for message in messages %}
        {% partial chat-bubble %}
        {% endfor %}
    </div>


    <form hx-post="{% url 'conversation_send_message' conversation_name %}" hx-target="#chat_messages"
        hx-swap="beforeend" hx-on::after-request="this.reset(); scrollChatDown();">
        {% csrf_token %}
        {{form | crispy}}
        <input type="submit" class="button" />
    </form>


</div>

<script>
    function scrollChatDown() {
        const box = document.getElementById('chat_messages');
        box.scrollTop = box.scrollHeight;
    }

    scrollChatDown()
</script>